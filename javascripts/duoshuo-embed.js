(function(e,t){if(e.DUOSHUO)return;var n=e.document,r=n.getElementsByTagName("head")[0]||n.getElementsByTagName("body")[0],i=n.createElement("input"),s=e.encodeURI,o=e.encodeURIComponent,u=e.navigator.userAgent,a=0,f=0,l=function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,r=function(t){return e[t]||"&amp;"};return function(e){return e==null||e===!1?"":n.test(e)?e.replace(t,r):e}}(),c={start:0,end:0},h=function(e){try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}},p=function(e){var t=0,r=0,i,s,o,u,a;return n.selection&&(s=n.selection.createRange(),s&&s.parentElement()==e&&(u=e.value.length,i=e.value.replace(/\r\n/g,"\n"),o=e.createTextRange(),o.moveToBookmark(s.getBookmark()),a=e.createTextRange(),a.collapse(!1),o.compareEndPoints("StartToEnd",a)>-1?t=r=u:(t=-o.moveStart("character",-u),t+=i.slice(0,t).split("\n").length-1,o.compareEndPoints("EndToEnd",a)>-1?r=u:(r=-o.moveEnd("character",-u),r+=i.slice(0,r).split("\n").length-1)))),c.start=t,c.end=r,{start:t,end:r}},d=function(e){return function(){return e}},v=e.DUOSHUO={DOMAIN:"duoshuo.com",REMOTE:"http://duoshuo.com",STATIC:"http://static.duoshuo.com",EMBED_STYLESHEET:"/styles/embed.css?0.2.css",loaded:{easyXDM:typeof easyXDM=="object",JSON:typeof e.JSON=="object"&&e.JSON,jQuery:typeof jQuery!="undefined"&&jQuery.fn.jquery>="1.5",smilies:!1},libs:{easyXDM:"/js/easyXDM.min.js",JSON:"/js/json2.min.js",jQuery:"/js/embed.compat.js"},sourceName:{weibo:"\u65b0\u6d6a\u5fae\u535a",qq:"QQ",qzone:"QQ\u7a7a\u95f4",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",douban:"\u8c46\u74e3\u7f51",netease:"\u7f51\u6613\u5fae\u535a",kaixin:"\u5f00\u5fc3\u7f51",sohu:"\u641c\u72d0\u5fae\u535a",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",google:"\u8c37\u6b4c"},serviceNames:{weibo:"\u5fae\u535a",qq:"QQ",douban:"\u8c46\u74e3",renren:"\u4eba\u4eba",netease:"\u7f51\u6613",kaixin:"\u5f00\u5fc3",sohu:"\u641c\u72d0",baidu:"\u767e\u5ea6",taobao:"\u6dd8\u5b9d",google:"\u8c37\u6b4c"},support:{autofocus:"autofocus"in i,placeholder:"placeholder"in i,multiple:"multiple"in i,iOS:u.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:u.match(/ \(Linux; U; Android /)},parseDate:function(e){return e.parse("2011-10-28T00:00:00+08:00")&&function(t){return new e(t)}||e.parse("2011/10/28T00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||e.parse("2011/10/28 00:00:00+0800")&&function(t){return new e(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new e(t)}}(Date),fullTime:function(e){var t=v.parseDate(e);return t.getFullYear()+"\u5e74"+(t.getMonth()+1)+"\u6708"+t.getDate()+"\u65e5 "+t.toLocaleTimeString()},elapsedTime:function(e){var t=v.parseDate(e),n=new Date,r=(n-a-t)/1e3;return r<10?"\u521a\u521a":r<60?Math.round(r)+"\u79d2\u524d":r<3600?Math.round(r/60)+"\u5206\u949f\u524d":r<86400?Math.round(r/3600)+"\u5c0f\u65f6\u524d":(n.getFullYear()==t.getFullYear()?"":t.getFullYear()+"\u5e74")+(t.getMonth()+1)+"\u6708"+t.getDate()+"\u65e5"},require:function(e,t){if(typeof e=="string")v.loaded[e]?t():x(v.STATIC+v.libs[e],function(){v.loaded[e]=!0,t()});else if(typeof e=="object"){var n,r=!0;for(n=0;n<e.length;n++)(function(i){if(v.loaded[e[n]])return;r=!1,x(v.STATIC+v.libs[i],function(){v.loaded[i]=!0;for(var n=0;n<e.length;n++)if(!v.loaded[e[n]])return;t()})})(e[n]);r&&t()}},injectStylesheet:function(e){var t=n.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,r.appendChild(t)},injectStyle:function(e){var t=n.createElement("style");t.type="text/css",e=e.replace(/\}/g,"}\n"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(n.createTextNode(e)),r.appendChild(t)},init:function(e,t){e&&!m[e]&&(m[e]=t||{type:"EmbedThread"}),v.initView&&v.initView()}},m=v.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentCommentsWidget"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"}},g=v.pagelets={},y=v.jsonData={threads:{},posts:{}},b=v.Collections={},w=v.Views={},E=v.Callbacks={},S=v.openDialog=function(e){return v.dialog!==t&&v.dialog.el.remove(),v.dialog=(new w.Dialog(e)).open()},x=v.injectScript=function(t,i){var s=n.createElement("script");s.type="text/javascript",s.src=t,s.async=!0,s.charset="utf-8",i&&(s.addEventListener?s.addEventListener("load",i,!1):s.attachEvent&&s.attachEvent("onreadystatechange",function(t){var n=t.srcElement.readyState;(n=="loaded"||n=="complete")&&i.call(e)})),r.appendChild(s)},T=v.showError=function(e){alert(e)},N=v.checkResponse=function(e,t){return function(n){switch(n.code){case 0:e(n,n.response);break;default:t&&t(n),T("\u51fa\u9519\u5566("+n.code+"): "+n.errorMessage),n.errorTrace&&T(n.errorTrace)}}},C=v.smilies={WordPress:{":mrgreen:":"icon_mrgreen.gif",":neutral:":"icon_neutral.gif",":twisted:":"icon_twisted.gif",":arrow:":"icon_arrow.gif",":shock:":"icon_eek.gif",":smile:":"icon_smile.gif",":???:":"icon_confused.gif",":cool:":"icon_cool.gif",":evil:":"icon_evil.gif",":grin:":"icon_biggrin.gif",":idea:":"icon_idea.gif",":oops:":"icon_redface.gif",":razz:":"icon_razz.gif",":roll:":"icon_rolleyes.gif",":wink:":"icon_wink.gif",":cry:":"icon_cry.gif",":eek:":"icon_surprised.gif",":lol:":"icon_lol.gif",":mad:":"icon_mad.gif",":sad:":"icon_sad.gif","8-)":"icon_cool.gif","8-O":"icon_eek.gif",":-(":"icon_sad.gif",":-)":"icon_smile.gif",":-?":"icon_confused.gif",":-D":"icon_biggrin.gif",":-P":"icon_razz.gif",":-o":"icon_surprised.gif",":-x":"icon_mad.gif",":-|":"icon_neutral.gif",";-)":"icon_wink.gif","8)":"icon_cool.gif","8O":"icon_eek.gif",":(":"icon_sad.gif",":)":"icon_smile.gif",":?":"icon_confused.gif",":D":"icon_biggrin.gif",":P":"icon_razz.gif",":o":"icon_surprised.gif",":x":"icon_mad.gif",":|":"icon_neutral.gif",";)":"icon_wink.gif",":!:":"icon_exclaim.gif",":?:":"icon_question.gif"},"\u5fae\u535a-\u9ed8\u8ba4":{"[\u7ec7]":"41/zz2_org.gif","[\u795e\u9a6c]":"60/horse2_org.gif","[\u6d6e\u4e91]":"bc/fuyun_org.gif","[\u7ed9\u529b]":"c9/geili_org.gif","[\u56f4\u89c2]":"f2/wg_org.gif","[\u5a01\u6b66]":"70/vw_org.gif","[\u718a\u732b]":"6e/panda_org.gif","[\u5154\u5b50]":"81/rabbit_org.gif","[\u5965\u7279\u66fc]":"bc/otm_org.gif","[\u56e7]":"15/j_org.gif","[\u4e92\u7c89]":"89/hufen_org.gif","[\u793c\u7269]":"c4/liwu_org.gif","[\u5475\u5475]":"ac/smilea_org.gif","[\u563b\u563b]":"0b/tootha_org.gif","[\u54c8\u54c8]":"6a/laugh.gif","[\u53ef\u7231]":"14/tza_org.gif","[\u53ef\u601c]":"af/kl_org.gif","[\u6316\u9f3b\u5c4e]":"a0/kbsa_org.gif","[\u5403\u60ca]":"f4/cj_org.gif","[\u5bb3\u7f9e]":"6e/shamea_org.gif","[\u6324\u773c]":"c3/zy_org.gif","[\u95ed\u5634]":"29/bz_org.gif","[\u9119\u89c6]":"71/bs2_org.gif","[\u7231\u4f60]":"6d/lovea_org.gif","[\u6cea]":"9d/sada_org.gif","[\u5077\u7b11]":"19/heia_org.gif","[\u4eb2\u4eb2]":"8f/qq_org.gif","[\u751f\u75c5]":"b6/sb_org.gif","[\u592a\u5f00\u5fc3]":"58/mb_org.gif","[\u61d2\u5f97\u7406\u4f60]":"17/ldln_org.gif","[\u53f3\u54fc\u54fc]":"98/yhh_org.gif","[\u5de6\u54fc\u54fc]":"6d/zhh_org.gif","[\u5618]":"a6/x_org.gif","[\u8870]":"af/cry.gif","[\u59d4\u5c48]":"73/wq_org.gif","[\u5410]":"9e/t_org.gif","[\u6253\u54c8\u6c14]":"f3/k_org.gif","[\u62b1\u62b1]":"27/bba_org.gif","[\u6012]":"7c/angrya_org.gif","[\u7591\u95ee]":"5c/yw_org.gif","[\u998b\u5634]":"a5/cza_org.gif","[\u62dc\u62dc]":"70/88_org.gif","[\u601d\u8003]":"e9/sk_org.gif","[\u6c57]":"24/sweata_org.gif","[\u56f0]":"7f/sleepya_org.gif","[\u7761\u89c9]":"6b/sleepa_org.gif","[\u94b1]":"90/money_org.gif","[\u5931\u671b]":"0c/sw_org.gif","[\u9177]":"40/cool_org.gif","[\u82b1\u5fc3]":"8c/hsa_org.gif","[\u54fc]":"49/hatea_org.gif","[\u9f13\u638c]":"36/gza_org.gif","[\u6655]":"d9/dizzya_org.gif","[\u60b2\u4f24]":"1a/bs_org.gif","[\u6293\u72c2]":"62/crazya_org.gif","[\u9ed1\u7ebf]":"91/h_org.gif","[\u9634\u9669]":"6d/yx_org.gif","[\u6012\u9a82]":"89/nm_org.gif","[\u5fc3]":"40/hearta_org.gif","[\u4f24\u5fc3]":"ea/unheart.gif","[\u732a\u5934]":"58/pig.gif","[ok]":"d6/ok_org.gif","[\u8036]":"d9/ye_org.gif","[good]":"d8/good_org.gif","[\u4e0d\u8981]":"c7/no_org.gif","[\u8d5e]":"d0/z2_org.gif","[\u6765]":"40/come_org.gif","[\u5f31]":"d8/sad_org.gif","[\u8721\u70db]":"91/lazu_org.gif","[\u949f]":"d3/clock_org.gif","[\u86cb\u7cd5]":"6a/cake.gif","[\u8bdd\u7b52]":"1b/m_org.gif","[\u56f4\u8116]":"3f/weijin_org.gif","[\u8f6c\u53d1]":"02/lxhzhuanfa_org.gif","[\u8def\u8fc7\u8fd9\u513f]":"ac/lxhluguo_org.gif","[bofu\u53d8\u8138]":"bb/bofubianlian_org.gif","[gbz\u56f0]":"f5/gbzkun_org.gif","[\u751f\u95f7\u6c14]":"47/boboshengmenqi_org.gif","[\u4e0d\u8981\u554a]":"5e/chn_buyaoya_org.gif","[dx\u6cea\u5954]":"ca/daxiongleibenxiong_org.gif","[\u8fd0\u6c14\u4e2d]":"c3/cat_yunqizhong_org.gif","[\u6709\u94b1]":"e6/youqian_org.gif","[\u51b2\u950b]":"2f/cf_org.gif","[\u7167\u76f8\u673a]":"33/camera_org.gif"}},k=["EmbedThread","RecentCommentsWidget","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"],L=0,A=v.templates={userAnchor:function(e){return e.url?'<a rel="author" target="_blank" href="'+s(e.url)+'">'+l(e.name)+"</a>":l(e.name)},authorAnchor:function(e){var t=e.author_name||e.author.name,n=e.author_url||e.author.url;return n?'<a rel="author" target="_blank" href="'+s(n)+'">'+l(t)+"</a>":l(t)},avatar:function(e,t){return'<img src="'+s(e&&e.avatar_url||H.data.default_avatar_url)+'" '+(t?'width="'+t+'" height="'+t+'" ':"")+(e.user_id?'data-user-id="'+e.user_id+'" ':"")+"/>"},timeHtml:function(e,t){return e?t?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+e+'" title="'+v.fullTime(e)+'">'+v.elapsedTime(e)+"</a>":'<span class="ds-time" datetime="'+e+'" title="'+v.fullTime(e)+'">'+v.elapsedTime(e)+"</span>":""},serviceIcon:function(e,t){return'<span class="ds-connected-sites"><a href="javascript:void(0)" class="ds-service-icon ds-'+e+(t?" ds-"+e+"-active":"")+'" data-service="'+e+'" title="'+v.sourceName[e]+'"></a></span>'},loginButtons:function(e){return'<img src="/images/angel.gif"><div class="ds-login-buttons"><div class="ds-border-highlight"></div><p>\u4f7f\u7528\u793e\u4ea4\u5e10\u53f7\u767b\u5f55:</p>'+A.serviceList()+A.additionalServices()+"</div>"},copyRights:[function(e){return l(e.name)+"\u6b63\u5728\u4f7f\u7528\u591a\u8bf4"},d("\u591a\u8bf4"),d("Powered by \u591a\u8bf4"),d("\u591a\u8bf4\u5f3a\u529b\u9a71\u52a8")],poweredBy:function(e){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+A.copyRights[e.copyright_template](e)+"</a></p>"},indicator:d('<div id="ds-indicator"><img src="'+v.STATIC+'/images/loading.gif"/></div>'),waitingImg:d(e.XMLHttpRequest?'<img width="16" height="11" alt="..." src="data:image/gif;base64,R0lGODlhEAALAPQAAP///z2LqeLt8dvp7u7090GNqz2LqV+fuJ/F1IW2ycrf51aatHWswaXJ14i4ys3h6FmctUCMqniuw+vz9eHs8fb5+meku+Tu8vT4+cfd5bbT3tbm7PH2+AAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA" style="margin:0 0 3px 5px"/>':"..."),serviceList:function(e){return'<ul class="ds-service-list">'+A.loginItem("weibo",e)+A.loginItem("qq",e)+A.loginItem("renren",e)+A.loginItem("douban",e)+A.loginItem("kaixin",e)+'<li><a class="ds-more-services" href="javascript:void(0)">\u66f4\u591a\u00bb</a></li>'+"</ul>"},additionalServices:function(e){return'<ul class="ds-service-list ds-additional-services">'+A.loginItem("taobao",e)+A.loginItem("netease",e)+A.loginItem("sohu",e)+A.loginItem("baidu",e)+A.loginItem("google",e)+"</ul>"},loginItem:function(e,t){var n=A.loginUrl(e,t);return'<li><span class="ds-connected-sites"><a href="'+n+'" rel="nofollow" class="ds-service-icon ds-'+e+" ds-"+e+'-active"></a>'+"</span>"+'<a href="'+n+'" rel="nofollow">'+v.serviceNames[e]+"</a>"+(B.data.connected_services[e]?'<span class="ds-ui-icon"></span>':"")+"</li>"}},O=function(e){return e.author_name||e.author&&e.author.name};for(;L<k.length;L++)v[k[L]]=function(e){return function(t,n){n=n||{},n.type=e,t&&!m[t]&&(m[t]=n),v.initSelector&&v.initSelector(t,n)}}(k[L]);var M=0,_=v.Class=function(){};_.extend=function(e){function r(){!M&&this.init&&this.init.apply(this,arguments)}M=1;var t=new this;M=0;for(var n in e)t[n]=e[n];return r.prototype=t,r.prototype.constructor=r,r.extend=arguments.callee,r};var D=v.Model=_.extend({init:function(e){this.handlers={},this.data=e},reset:function(e){this.data=e,this.trigger("reset")},remove:function(e){this.data.splice(e,1),this.trigger("reset")},on:function(e,n){return this.handlers[e]===t&&(this.handlers[e]=[]),this.handlers[e].push(n),this},trigger:function(e,t){var n=this.handlers[e];if(n)for(var r=0;r<n.length;r++)if(n[r].call(this,t)===!1)break;return this},set:function(e,n){if(n===t)for(var r in e)this.data[r]=e[r];else this.data[e]=n;this.trigger("reset")}}),P=v.threads={},H=v.site=new D,B=v.visitor=new D,j=v.unreadComments=new D,F=v.unreadNotifications=new D,I=v.parentPosts=new D({});v.loaded.jQuery&&(v.jQuery=e.jQuery),v.require("jQuery",function(){function R(){q=setTimeout(function(){q&&M.fadeOut(100)},350)}function z(){return{referer:n.referrer,user_agent:u,require:U++?"site,visitor,serverTime":"site,visitor,serverTime,unreadComments,unreadNotifications,log,extraCss"}}function W(){var t=e.duoshuoQuery;if(!t)return!1;v.hostUrl=t.short_name?"http://"+t.short_name+"."+v.DOMAIN:v.REMOTE}var r=v.jQuery,i=r(e),d=r(n),y=e.console||{log:r.noop},E=v.post=function(t,n,i,s){var o=e.duoshuoQuery;return n.short_name=o.short_name,o.sso&&(n.sso=1),o.remote_auth&&(n.remote_auth=o.remote_auth),v.xhr.request({url:t,method:"POST",data:n},function(e){try{var t=easyXDM.getJSONObject().parse(e.data);N(i,s)(t)}catch(n){}},s||r.noop)},T=v.ajaxJsonp=function(n,i,s,u){var a=e.duoshuoQuery;if(r.isFunction(s)){var f="cb_"+Math.round(Math.random()*1e6);v[f]=N(s,u),s="DUOSHUO['"+f+"']"}var l="?callback="+o(s);a.sso&&(i.sso=1),a.remote_auth&&(i.remote_auth=a.remote_auth),r.each(i,function(e,n){n!=t&&(l+="&"+e+"="+o(n))}),x(v.hostUrl+n+l)},k=v.loadRequire=function(e){e.serverTime&&(a=(new Date).getTime()-e.serverTime*1e3),e.visitor&&B.reset(e.visitor),e.site&&H.reset(e.site);if(e.stylesheets)for(var t=0;t<e.stylesheets.length;t++)v.injectStylesheet(e.stylesheets[t]);e.style&&v.injectStyle(e.style),e.unreadComments&&j.reset(e.unreadComments),e.unreadNotifications&&F.reset(e.unreadNotifications)};r.extend(A,{loginUrl:function(e,t){var n=v.hostUrl+(t?"/bind/":"/login/")+e+"/";return duoshuoQuery.sso&&duoshuoQuery.sso.login&&(n+="?sso=1&redirect_uri="+o(duoshuoQuery.sso.login)),n},logoutUrl:function(){var e=v.hostUrl+"/logout/";return duoshuoQuery.sso&&duoshuoQuery.sso.logout&&(e+="?sso=1&redirect_uri="+o(duoshuoQuery.sso.logout)),e}}),v.scrollTo=function(e){var t=e.offset().top+e.height()-i.height();t>i.scrollTop()&&r("html, body").animate({scrollTop:t},200,"swing")},v.toJSON=function(e){var t=/\r?\n/g,n=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,i=/^(?:select|textarea)/i,s=e.map(function(){return this.elements?r.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||i.test(this.nodeName)||n.test(this.type))}).map(function(e,n){var i=r(this).val();return i==null?null:r.isArray(i)?r.map(i,function(e,r){return{name:n.name,value:e.replace(t,"\r\n")}}):{name:n.name,value:i.replace(t,"\r\n")}}).toArray(),o={};return r.each(s,function(){o[this.name]=this.value}),o};var L=v.Widget=_.extend({init:function(e,t){this.el=e,this.options=t||{},this.render()},render:function(){},reset:function(){},load:function(e){k(e),this.onload(e)},onload:function(e){this.el.html(A[this.template].call(A,e.response,r.extend(this.options,e.options)))}});v.resetNotify=function(){var e=r("#ds-notify"),t=j.data?j.data.length:0,i=F.data?F.data.length:0;e.length===0&&(e=r('<div id="ds-notify"></div>').addClass("ds-"+H.data.notify_position).delegate("a.ds-notify-unread-comments","click",v.unreadCommentsDialog).delegate("a.ds-notify-unread-notifications","click",v.unreadNotificationsDialog).appendTo(n.body)),t+i?e.html('<a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="\u591a\u8bf4"></a><ul class="ds-notify-unread"><li><a class="ds-notify-unread-comments" href="javascript:void(0);"'+(t?"":' style="display:none;"')+">\u4f60\u6709"+t+"\u6761\u65b0\u56de\u590d</a></li>"+'<li><a class="ds-notify-unread-notifications" href="javascript:void(0);"'+(i?"":' style="display:none;"')+">\u4f60\u6709"+i+"\u6761\u7cfb\u7edf\u6d88\u606f</a></li>"+"</ul>").show():e.hide()},j.on("reset",v.resetNotify),F.on("reset",v.resetNotify),A.replybox=function(e,t){var n=B.data,r=[],i="",s;for(service in n.repostOptions)n.repostOptions[service]&&(r.push(service),s=1),i+=A.serviceIcon(service,n.repostOptions[service]);return'<div class="ds-replybox"><form method="post" action="" onsubmit="return false;"><input type="hidden" name="thread_id" value="'+e+'" />'+'<input type="hidden" name="parent_id" value="" />'+(n.user_id?"":'<input type="hidden" name="author_name" value="'+l(n.name)+'" /><input type="hidden" name="author_email" value="'+l(n.email)+'" /><input type="hidden" name="author_url" value="'+l(n.url)+'" />')+'<div class="ds-replybox-main">'+'<div class="ds-textarea-wrapper">'+'<textarea name="message" title="Ctrl+Enter\u5feb\u6377\u63d0\u4ea4" placeholder="\u8bf4\u70b9\u4ec0\u4e48\u5427 ..."></textarea>'+'<pre class="ds-hidden-text"></pre>'+"</div>"+'<div class="ds-post-toolbar">'+'<div class="ds-post-options">'+(n.user_id?i?'<span class="ds-sync"><input id="ds-sync-checkbox'+(t?"-inline":"")+'" type="checkbox" name="repost" '+(s?'checked="checked" ':"")+'value="'+r.join(",")+'"> <label for="ds-sync-checkbox'+(t?"-inline":"")+'">\u540c\u65f6\u5206\u4eab\u5230:</label> '+i+"</span>":"":H.data.deny_anonymous?"":'<span class="ds-sync" style="color: #999;">\u4e0d\u60f3\u767b\u5f55\uff1f\u76f4\u63a5\u70b9\u51fb\u53d1\u5e03\u5373\u53ef\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00\u3002</span>')+"</div>"+'<button class="ds-post-button" type="submit">\u53d1 \u5e03</button>'+'<div class="ds-toolbar-buttons">'+(H.data.use_smilies?'<a class="ds-toolbar-button ds-add-emote" title="\u63d2\u5165\u8868\u60c5"></a>':"")+(H.data.use_images?'<a class="ds-toolbar-button ds-add-image" title="\u63d2\u5165\u56fe\u7247"></a>':"")+"</div>"+"</div>"+"</div>"+"</form>"+"</div>"},w.Replybox=function(e){this.embedThread=e},w.Replybox.prototype={render:function(e){function T(e){e.data("submitting",!0),e.find(".ds-post-button").addClass("ds-waiting").html("\u6b63\u5728\u53d1\u5e03")[0].disabled=!0}function N(e){e.data("submitting",!1),e.find(".ds-post-button").removeClass("ds-waiting").html("\u53d1 \u5e03")[0].disabled=!1}var t=this,s=t.embedThread,o=function(e){v.loaded.smilies||(x(v.STATIC+"/js/smilies.js"),v.loaded.smilies=!0)},u=t.el=r(A.replybox(s.threadId,e)).click(o),a=u.find("form"),f=a.find("input[type=checkbox]")[0],l=a.find("span.ds-connected-sites a"),d=u.find("pre.ds-hidden-text"),m=a.find("textarea").focus(o).keyup(function(e){if(e.ctrlKey&&e.which==13||e.which==10)a.data("submitting")||a.trigger("submit");p(this)}).keyup(function(e){d.text(this.value),r(this).height(Math.max(54,d.height()+27)),p(this)}).focus(function(){p(this)}).mousedown(function(){p(this)}).mouseup(function(){p(this)}),g=u.find(".ds-add-emote").click(function(e){var i=v.smiliesTooltip;if(g.toggleClass("ds-expanded").hasClass("ds-expanded")){i||(i=v.smiliesTooltip=new w.SmiliesTooltip,i.render().reset("\u5fae\u535a-\u9ed8\u8ba4")),i.replybox=t;var s=t.el.offset();i.el.appendTo(n.body).css({top:s.top+t.el.outerHeight()+5+"px",left:s.left+"px"}).show(),r(n.body).click(b),o(e)}else b(e);return!1}),y=u.find(".ds-add-image").click(function(e){var t=m[0],r=t.value,i="\u8bf7\u8f93\u5165\u56fe\u7247\u5730\u5740",s='<img src="'+i+'" />';if(n.selection){t.value=r.substring(0,c.start)+s+r.substring(c.end,r.length),t.value=t.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),t.focus();var o=n.selection.createRange();o.collapse(),o.findText(i),o.select()}else{t.value=r.substring(0,t.selectionStart)+s+r.substring(t.selectionEnd);var u=t.value.search(i);t.setSelectionRange(u,u+i.length),t.focus()}e.preventDefault()}),b=t.hideSmilies=function(e){g.removeClass("ds-expanded"),v.smiliesTooltip.el.hide(),r(n.body).unbind("click",b)};H.data.deny_anonymous&&m.focus(function(e){if(!B.data.user_id){v.anonymousDialog(a,C);var t=function(e){e.stopPropagation(),m.unbind("click",t)};m.click(t)}return!1});if(!v.support.placeholder){var S=m.attr("placeholder");m.val(S).focus(function(){this.value===S&&(this.value="")}).blur(function(){this.value===""&&(this.value=S)})}var C=function(){T(a),E("/api/posts/create.json",v.toJSON(r(a)),function(e,n){var o=s.options.order=="asc",f=s.options.formPosition=="top",l=r(A.postWithChildren(n));I.set(n.post_id,n),l=l.hide()[o?"appendTo":"prependTo"](t.postList);var c=l.find(".ds-post-color").show();l.slideDown(function(){c.delay(1e3).fadeOut(200)}),f==o&&i.scrollTop(l.offset().top-200);var h=s.el.find(".ds-comments-tab-duoshuo span.ds-highlight");h.html(parseInt(h.html())+1),m.val("").height(54),N(a),u.hasClass("ds-inline-replybox")&&(u.hide(),t.replyButton.removeClass("ds-reply-active"))},function(e){N(a)})};a.submit(function(e){var t=r.trim(a[0].message.value);return t==""||!v.support.placeholder&&t==m.attr("placeholder")?(alert("\u60a8\u8fd8\u6ca1\u5199\u5185\u5bb9\u5462"),!1):(B.data.user_id==0?v.anonymousDialog(a,C):(h("D")&&localStorage.removeItem("messageTempContent"+s.threadId),C()),!1)});var k=function(e){var t=r(e).attr("data-service");return r(e).hasClass("ds-"+t+"-active")?t:null};return l.click(function(){var e=r(this);service=e.attr("data-service"),e.toggleClass("ds-"+service+"-active"),f.value=r.map(l,k).join(","),f.checked=f.value!=""}),r(f).change(function(){var e=this.checked;l.each(function(){r(this)[e?"addClass":"removeClass"]("ds-"+r(this).attr("data-service")+"-active")}),this.value=r.map(l,k).join(",")}),this}},w.Dialog=function(e,n){var i=this;i.options=r.extend({width:600},n),i.el=r("#ds-wrapper"),i.el.length==0&&(i.el=r('<div id="ds-wrapper"></div>'),r.browser.msie&&(i.el.addClass("ds-ie"),r.browser.version<7&&i.el.addClass("ds-ie6"))),e!==t&&(r(e).attr("id","ds-reset").appendTo(i.el),i.el.find("a.ds-dialog-close").click(function(e){i.close()}))},w.Dialog.prototype={open:function(){var e=this;this.el.hide().appendTo(n.body).fadeIn(200),r.browser.msie&&r.browser.version<7&&(this.el.css("top",i.scrollTop()+100),r(".ds-thread select.ds-sort").css("visibility","hidden")),this.el.show().find(".ds-dialog").click(function(e){e.stopPropagation()});var t=function(t){if(t.which==27)return e.close(),!1},s=function(t){return e.close(),!1};return d.keydown(t),r(n.body).click(s),e.close=function(i){d.unbind("keydown",t),r(n.body).unbind("click",s),e.el.fadeOut(200,function(){r(this).remove(),r.browser.msie&&r.browser.version<7&&r(".ds-thread select.ds-sort").css("visibility","visible")})},e},setBody:function(e){this.el.find(".ds-dialog-body").html(e)},setFooter:function(e){this.el.find(".ds-dialog-footer").html(e)}},A.likePanel=function(e){return e.likes?'<span class="ds-highlight">'+e.likes+"</span> \u4eba\u559c\u6b22":""},A.likeTooltip=function(){var e={qzone:"QQ\u7a7a\u95f4",weibo:"\u65b0\u6d6a\u5fae\u535a",qqt:"\u817e\u8baf\u5fae\u535a",renren:"\u4eba\u4eba\u7f51",kaixin:"\u5f00\u5fc3\u7f51",douban:"\u8c46\u74e3\u7f51",baidu:"\u767e\u5ea6\u641c\u85cf",netease:"\u7f51\u6613\u5fae\u535a",sohu:"\u641c\u72d0\u5fae\u535a"},t=[];r.each(e,function(e,n){t.push('<li><a class="ds-share-to-'+e+" ds-service-link ds-"+e+'-active" href="javascript:void(0)">'+n+"</a></li>")});var n=Math.ceil(t.length/2);return'<div class="ds-like-tooltip"><p>\u5f88\u9ad8\u5174\u4f60\u80fd\u559c\u6b22\uff0c\u5206\u4eab\u4e00\u4e0b\u5427\uff1a</p><ul>'+t.slice(0,n).join("")+"</ul>"+"<ul>"+t.slice(n).join("")+"</ul>"+'<p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">\u7b97\u4e86</a></p>'+"</div>"},w.Meta=function(e){this.embedThread=e},w.Meta.prototype={render:function(){var i=this,s=i.embedThread,o=s.data,u=i.el=r('<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button'+(o.user_vote>0?" ds-thread-liked":"")+'"><span class="ds-ui-icon"></span>'+' <span class="ds-thread-like-text">'+(o.user_vote>0?"\u5df2\u559c\u6b22":"\u559c\u6b22")+'</span><span class="ds-thread-cancel-like">\u53d6\u6d88\u559c\u6b22</span></a>'+'<span class="ds-like-panel"></span>'+"</div>"),a=u.find(".ds-like-thread-button").click(function(f){var l=a.hasClass("ds-thread-liked");E("/api/threads/vote.json",{thread_id:s.threadId,vote:l?0:1},function(e){r.each(e.thread,function(e,t){o[e]=t}),i.resetLikePanel()}),a.toggleClass("ds-thread-liked"),a.find(".ds-thread-like-text").text(l?"\u559c\u6b22":"\u5df2\u559c\u6b22");var c=function(e){i.tooltip.detach(),r(n.body).unbind("click",c)};return l?i.tooltip&&c(f):(i.tooltip===t&&(i.tooltip=r(A.likeTooltip(o)).click(function(e){e.stopPropagation()}).delegate("a","click",function(t){switch(this.className){case"ds-like-tooltip-close":c(t);break;default:var n=this.className.match(/ds\-share\-to\-(\w+)/)[1];e.open("http://"+H.data.short_name+"."+v.DOMAIN+"/share-proxy/?service="+n+"&thread_id="+s.threadId,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no")}return!1})),i.tooltip.appendTo(s.innerEl).css({top:u.position().top+u.outerHeight()-4+"px",left:0}).show(),r(n.body).click(c)),!1});return i.resetLikePanel(),B.data.user_id||u.hide(),i},resetLikePanel:function(){this.el.find(".ds-like-panel").html(A.likePanel(this.embedThread.data))}},A.postListHead=function(e){return'<div class="ds-comments-info"><select class="ds-sort"><option value="desc">\u4ece\u65b0\u5230\u65e7\u6392\u5e8f</option><option value="asc">\u4ece\u65e7\u5230\u65b0\u6392\u5e8f</option></select><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"><span class="ds-highlight">'+e.comments+"</span>\u6761\u8bc4\u8bba</a></li>"+(H.data.show_reposts&&e.reposts?'<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"><span class="ds-highlight">'+e.reposts+"</span>\u6761\u8f6c\u8f7d</a></li>":"")+(H.data.show_weibo&&e.weibo_reposts?'<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"><span class="ds-highlight">'+e.weibo_reposts+"</span>\u6761\u65b0\u6d6a\u5fae\u535a</a></li>":"")+(H.data.show_qqt&&e.qqt_reposts?'<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"><span class="ds-highlight">'+e.qqt_reposts+"</span>\u6761\u817e\u8baf\u5fae\u535a</a></li>":"")+"</ul>"+"</div>"},w.PostListHead=function(e,t){this.embedThread=e,this.options=t},w.PostListHead.prototype={render:function(){var e=this.options,t=this.embedThread,n=t.postList,i=this.el=r(A.postListHead(e.thread)),s=i.find("ul.ds-comments-tabs").delegate(".ds-tab a","click",function(e){s.find("a.ds-current").removeClass("ds-current"),n.params.page=1;var i=e.currentTarget;switch(i.className){case"ds-comments-tab-duoshuo":n.params.source="duoshuo",t.replybox.el.show();break;case"ds-comments-tab-repost":n.params.source="repost",t.replybox.el.hide();break;case"ds-comments-tab-weibo":n.params.source="weibo",t.replybox.el.hide();break;case"ds-comments-tab-qqt":n.params.source="qqt",t.replybox.el.hide();break;default:}r(i).addClass("ds-current"),n.refetch()});i.find("select").val(e.order).change(function(e){n.params.order=t.options.order=this.value,n.refetch()})}},w.Paginator=function(e){e&&(this.el=e.el||r('<div class="ds-paginator"></div>'),e.collection&&(this.collection=e.collection))},w.Paginator.prototype={reset:function(e){function i(e){r.push('<a data-page="'+e+'" href="javascript:void(0);">'+e+"</a>")}var t=this.collection.params.page||1,n,r=[];if(t>1){i(1),n=t>4?t-2:2,n>2&&r.push('<span class="page-break">...</span>');for(;n<t;n++)i(n)}r.push('<a data-page="'+t+'" href="javascript:void(0);" class="ds-current">'+t+"</a>");if(t<e.pages){for(n=t+1;n<=t+4&&n<e.pages;n++)i(n);n<e.pages&&r.push('<span class="page-break">...</span>'),i(e.pages)}this.el.html('<div class="ds-border"></div>'+r.join(" ")),this.el[e.pages>1?"show":"hide"]()},render:function(){var e=this,t=e.collection;return this.el.delegate("a","click",function(n){return t.params.page=parseInt(this.innerHTML),t.refetch(),e.el.find(".ds-current").removeClass("ds-current"),r(this).addClass("ds-current"),!1}),this}},A.smiliesTooltip=function(){var e='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';return r.each(C,function(t,n){e+="<li><a>"+t+"</a></li>"}),e+"</ul>"+'<div class="ds-smilies-container"></div>'+"</div>"},v.addSmilies=function(e,t){var n=v.smiliesTooltip;n&&n.el.find("ul.ds-smilies-tabs").append("<li><a>"+e+"</a></li>"),v.smilies[e]=t},w.SmiliesTooltip=function(){},w.SmiliesTooltip.prototype={render:function(){var e=this,t=e.el=r(A.smiliesTooltip());return t.click(function(e){e.stopPropagation()}).find("ul.ds-smilies-tabs").delegate("a","click",function(t){e.reset(this.innerHTML)}),t.find(".ds-smilies-container").delegate("img","click",function(t){var r=e.replybox,i=r.el.find("textarea")[0],s=i.value;if(n.selection){i.value=s.substring(0,c.start)+this.title+s.substring(c.end,s.length),i.value=i.value.replace("\u8bf4\u70b9\u4ec0\u4e48\u5427 ...",""),i.focus();var o=n.selection.createRange();o.moveStart("character",c.start+this.title.length),o.collapse(),o.select()}else{var u=i.selectionStart+this.title.length;i.value=s.substring(0,i.selectionStart)+this.title+s.substring(i.selectionEnd),i.setSelectionRange(u,u)}r.hideSmilies(),i.focus()}),this},reset:function(e){var t=this.el.find("ul.ds-smilies-tabs");t.find("a.ds-current").removeClass("ds-current"),t.find("a").filter(function(){return this.innerHTML==e}).addClass("ds-current");var n='<ul style="">';return r.each(C[e],function(t,r){var i;e.indexOf("\u5fae\u535a")===0?i="http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+r.replace("_org","_thumb"):i=v.STATIC+"/images/smilies/"+r,e==="WordPress"&&(t=" "+t+" "),n+='<li><img src="'+i+'" title="'+l(t)+'" /></li>'}),n+="</ul>",this.el.find(".ds-smilies-container").html(n),this}},A.ctxPost=function(e,t){return'<li class="ds-ctx-entry"><div class="ds-avatar">'+A.avatar(e.author)+"</div>"+'<div class="ds-ctx-content"><p>'+A.authorAnchor(e)+A.timeHtml(e.created_at,e.url)+"</p>"+"<p>"+e.message+"</p></div>"+'<div style="clear:both"></div>'+"</li>"};var M=r('<div id="ds-ctx-bubble"><ul></ul><div><a class="ds-ctx-open" href="javascript:void(0);">\u67e5\u770b\u5bf9\u8bdd</a></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>').delegate("a.ds-ctx-open","click",function(t){t.stopPropagation(),T("/api/posts/conversation.jsonp",{post_id:M.data("post-id")},function(e,t){n.el.find("ul").html(r.map(t,function(e){return A.ctxPost(e,!0)}).join("\n"))});var n=S('<div class="ds-dialog" style="width:600px;"><div class="ds-dialog-inner"><div class="ds-dialog-header"><h2>\u67e5\u770b\u5bf9\u8bdd</h2><a class="ds-dialog-close" style="top:15px" href="javascript:void(0);"></a></div><div class="ds-dialog-body" style="'+(e.XMLHttpRequest?"max-height":"height")+':350px;overflow-y:auto;padding-top:10px">'+'<ul><li style="text-align:center">'+A.waitingImg()+"</li></ul>"+"</div>"+"</div>"+"</div>")}),q=0;M.hover(function(){clearTimeout(q),q=0},R),A.post=function(e){var t=e.author,n=e.author_url||t&&t.url;return'<div class="ds-post-self'+(e.vote>0?" ds-post-liked":"")+'" data-post-id="'+e.post_id+'" data-thread-id="'+e.thread_id+'">'+'<div class="ds-post-color"></div>'+'<div class="ds-post-main">'+'<div class="ds-avatar">'+(n?'<a href="'+s(n)+'" rel="nofollow" target="_blank">'+A.avatar(t)+"</a>":A.avatar(t))+(v.sourceName[e.source]?A.serviceIcon(e.source,1):"")+"</div>"+'<div class="ds-comment-body">'+'<div class="ds-comment-header">'+(n?'<a class="ds-user-name ds-highlight" href="'+s(n)+'" rel="nofollow" target="_blank">'+l(O(e))+"</a>":'<span class="ds-user-name">'+l(O(e))+"</span>")+"</div>"+"<p>"+
(e.parent_id&&I.data[e.parent_id]?'<a class="ds-comment-context" data-post-id="'+e.post_id+'" data-parent-id="'+e.parent_id+'"><span class="ds-ui-icon"></span>\u56de\u590d '+l(O(I.data[e.parent_id]))+": </a>":"")+e.message+"</p>"+'<div class="ds-comment-footer">'+A.timeHtml(e.created_at,e.url)+(e.source!="weibo"&&e.source!="qqt"?'<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-ui-icon"></span>\u56de\u590d</a>':"")+(e.source!="weibo"&&e.source!="qqt"&&B.data.user_id?'<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-post-like"><span class="ds-ui-icon"></span></span><span class="ds-post-unlike"><span class="ds-ui-icon"></span></span> \u8d5e <span class="ds-post-like-count">'+(e.likes>0?e.likes:"")+"</span></a>":"")+(e.source!="weibo"&&e.source!="qqt"?' <a class="ds-post-report" href="javascript:void(0);"><span class="ds-ui-icon"></span> \u4e3e\u62a5</a>':"")+(e.source!="weibo"&&e.source!="qqt"&&e.privileges["delete"]?' <a class="ds-post-delete" href="javascript:void(0);"><span class="ds-ui-icon"></span> \u5220\u9664</a>':"")+"</div>"+"</div>"+"</div>"+"</div>"},A.postWithChildren=function(e){var t='<li class="ds-post" data-post-id="'+e.post_id+'">'+A.post(e);return e.children&&(t+='<div class="ds-children-wrapper"><div class="ds-children-control"><a class="ds-collapse"><span class="ds-ui-icon"></span></a><a class="ds-expand"></a></div><div class="ds-collapse-padding"></div><ul class="ds-children">'+r.map(e.children,A.postWithChildren).join("")+"</ul>"+"</div>"),t+"</li>"},b.PostList=function(e){e&&(e.params&&(this.params=e.params),e.embedThread&&(this.embedThread=e.embedThread)),this.el=r('<ul class="ds-comments"></ul>')},b.PostList.prototype={url:"/api/posts/list",render:function(){var e=this.embedThread;return this.el.delegate("a.ds-post-likes","click",function(e){var t=r(this).parents(".ds-post-self"),n=r(this).find(".ds-post-like-count"),i=t.hasClass("ds-post-liked");return E("/api/posts/vote.json",{post_id:t.data("post-id"),vote:i?0:1},r.noop),n.html((n.html()==""?0:parseInt(n.html()))+(i?-1:1)),t[i?"removeClass":"addClass"]("ds-post-liked"),!1}).delegate("a.ds-comment-context","mouseenter",function(){q&&(clearTimeout(q),q=0);var t=r(this),n=t.offset(),i=e.el.offset(),s=e.el.height()-(n.top-i.top)+10,o=n.left-i.left,u=I.data[t.data("parent-id")];M.data("post-id",t.data("post-id")).find("ul").html(A.ctxPost(u)),M.appendTo(e.innerEl).stop().css({bottom:s,left:o,opacity:1}).show()}).delegate("a.ds-comment-context","mouseleave",R).delegate("a.ds-post-delete","click",function(t){if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var n=r(this).parents(".ds-post-self");E("/api/posts/remove.json",{post_id:n.data("post-id")},r.noop),n.parent().fadeOut(200,function(){var t=r(this).parent(".ds-children"),n=e.el.find(".ds-comments-tab-duoshuo span.ds-highlight");t.children("li:visible").length<1&&t.siblings(".ds-children-control, .ds-collapse-padding").remove(),n.html(parseInt(n.html())-Math.max(t.find(".ds-post-self").length,1)),r(this).remove()})}return!1}).delegate("a.ds-post-report","click",function(e){if(confirm("\u786e\u5b9a\u8981\u4e3e\u62a5\u8fd9\u6761\u8bc4\u8bba\u5417\uff1f")){var t=r(this).parents(".ds-post-self");E("/api/posts/report.json",{post_id:t.data("post-id")},r.noop),alert("\u611f\u8c22\u60a8\u7684\u53cd\u9988\uff01")}return!1}).delegate("a.ds-post-reply","click",function(t){var n=e.inlineReplybox;if(r(this).hasClass("ds-reply-active"))n.el.fadeOut(200,function(){r(this).hide()}),r(this).removeClass("ds-reply-active");else{var i=r(this).parents(".ds-post-self"),s=i.siblings("ul.ds-children");s.length==0&&(s=r('<ul class="ds-children"></ul>').insertAfter(i)),n?n.replyButton.removeClass("ds-reply-active"):(n=e.inlineReplybox=new w.Replybox(e),n.render(!0).el.addClass("ds-inline-replybox").hide()),n.postList=H.data.max_depth<=1?e.postList.el:s,n.replyButton=r(this).addClass("ds-reply-active"),n.el.find("[name=parent_id]").val(i.data("post-id")),n.el[e.options.order=="asc"?"insertAfter":"insertBefore"](s).fadeIn(200).find("textarea").focus()}}).delegate("div.ds-children-control","click",function(e){var t=r(this).parent().toggleClass("ds-collapsed");r(this).children(".ds-expand").html('<span class="ds-ui-icon"></span>\u5c55\u5f00'+t.find(".ds-post-self").length+"\u6761\u56de\u590d")}),this},reset:function(e){this.el.html(r.map(e,A.postWithChildren).join(""))},refetch:function(){var e=this,t=r("#ds-indicator").fadeIn(200);e.el.fadeTo(200,.5),T(e.url+".jsonp",e.params,function(n,r){I.set(n.parentPosts),e.reset(r),e.embedThread.paginator.reset(n.cursor),t.fadeOut(200),e.el.fadeTo(200,1)})}},v.anonymousDialog=function(e,t){var n=e[0].author_email.value,r=e[0].author_name.value,i=e[0].author_url.value,s=S('<div class="ds-dialog '+(H.data.deny_anonymous?"ds-dialog-login-deny-anonymous":"ds-dialog-login")+'">'+'<div class="ds-dialog-inner">'+'<div class="ds-dialog-body">'+'<div class="ds-dialog-left">'+"<h2>\u7528\u793e\u4ea4\u5e10\u53f7\u767b\u5f55</h2>"+A.serviceList()+A.additionalServices()+"</div>"+(H.data.deny_anonymous?"":'<div class="ds-dialog-right"><h2>\u4f5c\u4e3a\u6e38\u5ba2\u7559\u8a00</h2><form><div class="ds-input"><input type="text" name="name" id="ds-dialog-name" value="'+r+'" required />'+'<label for="ds-dialog-name">\u540d\u5b57(\u5fc5\u987b)</label>'+"</div>"+'<div class="ds-input">'+'<input type="text" name="email" id="ds-dialog-email" value="'+n+'" required />'+'<label for="ds-dialog-email">\u90ae\u7bb1(\u5fc5\u987b)</label>'+"</div>"+'<div class="ds-input">'+'<input type="text" name="url" id="ds-dialog-url" value="'+(i||"http://")+'" />'+'<label for="ds-dialog-url">\u7f51\u5740(\u53ef\u9009)</label>'+"</div>"+'<button type="submit">\u53d1 \u5e03</button>'+"</form>"+"</div>")+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>");if(!H.data.deny_anonymous){var o=s.el.find("form");o.submit(function(n){var r=o.find("input[name=name]").val(),i=o.find("input[name=email]").val(),u=o.find("input[name=url]").val();return i.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(e.find("input[name=author_name]").val(r),e.find("input[name=author_email]").val(i),e.find("input[name=author_url]").val(u),t(),s.close(),!1):(alert("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6709\u6548\u7684email\u5730\u5740."),!1)}),o.find("input[name=name]")[0].focus()}},v.bindMoreAccountDialog=function(){return S('<div class="ds-dialog ds-dialog-bind-more" style="width: 300px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u7ed1\u5b9a\u66f4\u591a\u5e10\u53f7</h2>'+A.serviceList(1)+A.additionalServices(1)+'<div style="clear:both"></div>'+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),!1},v.unreadCommentsDialog=function(){var e=S('<div class="ds-dialog" style="width: 450px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u65b0\u7559\u8a00\u53ca\u56de\u590d</h2><ul class="ds-unread-comments">'+r.map(j.data,function(e){return'<li data-thread-id="'+e.thread.thread_id+'">'+r.map(e.authors,A.userAnchor).join("\u3001")+' \u5728 <a href="'+e.thread.url+'#comments" target="_blank">'+(e.thread.title||"\u65e0\u6807\u9898")+'</a> \u4e2d\u56de\u590d\u4e86\u4f60<a class="ds-delete" title="\u77e5\u9053\u4e86">\u77e5\u9053\u4e86</a></li>'}).join("\n")+"</ul>"+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),t=e.el.find(".ds-unread-comments").delegate(".ds-delete","click",function(n){var i=r(this).parent(),s=i.data("thread-id");E("/api/threads/read.json",{thread_id:s},r.noop),r.each(j.data,function(e,t){t.thread.thread_id==s&&j.remove(e)}),i.remove(),t.children().length===0&&e.close()});return r("#ds-notify .ds-notify-unread-comments").hide(),r("#ds-notify .ds-notify-unread-notifications")[0].style.display=="none"&&r("#ds-notify").hide(),!1},v.unreadNotificationsDialog=function(){var e=S('<div class="ds-dialog" style="width: 450px;"><div class="ds-dialog-inner"><div class="ds-dialog-body"><h2>\u7cfb\u7edf\u6d88\u606f</h2><ul class="ds-unread-notifications">'+r.map(F.data,function(e){return'<li data-notification-id="'+e.notification_id+'" data-notification-type="'+e.type+'">'+e.content+'</a> <a class="ds-delete" title="\u77e5\u9053\u4e86">\u77e5\u9053\u4e86</a></li>'}).join("\n")+"</ul>"+"</div>"+'<div class="ds-dialog-footer">'+'<a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>\u793e\u4f1a\u5316\u8bc4\u8bba\u6846</span>'+"</div>"+'<a class="ds-dialog-close" href="javascript:void(0)" title="\u5173\u95ed"></a>'+"</div>"+"</div>"),t=e.el.find(".ds-unread-notifications").delegate(".ds-delete","click",function(n){var i=r(this).parent(),s=i.data("notification-id");E("/api/notifications/read.json",{notification_id:s},r.noop),r.each(F.data,function(e,t){t.notificationId==s&&F.remove(e)}),i.remove(),t.children().length===0&&e.close()});return r("#ds-notify .ds-notify-unread-notifications").hide(),r("#ds-notify .ds-notify-unread-comments")[0].style.display=="none"&&r("#ds-notify").hide(),!1},A.toolbar=function(e){var t=A.logoutUrl(),n="";return'<div class="ds-toolbar"><div class="ds-border-highlight"></div><div class="ds-visitor"><span class="ds-visitor-avatar"><img src="'+s(B.data.avatar_url)+'"/>'+"</span>"+(B.data.url?'<a class="ds-visitor-name" href="'+s(B.data.url)+'" target="_blank">'+l(B.data.name)+"</a>":'<span class="ds-visitor-name">'+l(B.data.name)+"</span>")+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="\u65b0\u56de\u590d"></a>'+'<span><a style="vertical-align:baseline" target="_blank" rel="nofollow" href="http://duoshuo.com/settings/'+n+'">\u8bbe\u7f6e</a></span>'+"</div>"+'<div class="ds-account-control">'+'<span class="ds-ui-icon"></span> <span>\u5e10\u53f7\u7ba1\u7406</span>'+"<ul>"+'<li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">\u7ed1\u5b9a\u66f4\u591a</a></li>'+'<li><a target="_blank" href="http://duoshuo.com/settings/'+n+'">\u8bbe\u7f6e</a></li>'+'<li><a rel="nofollow" href="'+t+'" style="border-bottom: none">\u767b\u51fa</a></li>'+"</ul>"+"</div>"+"</div>"},w.EmbedThread=L.extend({uri:"/api/threads/listPosts",params:["thread-id","local-thread-id","source-thread-id","thread-key","author-key","category","limit","order","title","url","form-position","author-id","image","thumbnail"],render:function(){var t=this.el;t.attr("id","ds-thread"),!t.data("thread-id")&&!t.data("url")&&t.data("url",e.location.href),this.waitingEl=r('<div class="ds-waiting"></div>').html(A.waitingImg()).appendTo(t)},onload:function(e){var i=this,s=i.threadId=e.thread.thread_id,o=e.cursor,u=i.options=e.options,a=i.innerEl=r('<div id="ds-reset"></div>').appendTo(i.el);i.data=e.thread,v.parentPosts.set(e.parentPosts),i.waitingEl.hide(),u.formPosition=="top"&&a.css("margin-top","15px");if(r.browser.msie){a.addClass("ds-ie");var f=r.browser.version;f<7&&a.addClass("ds-ie6"),f<8&&a.addClass("ds-ie7"),f<9&&a.addClass("ds-ie8")}H.data.like_thread_enabled&&(i.meta=new w.Meta(i),i.meta.render().el.appendTo(a));if(B.data.user_id==0){i.loginButtons=r(A.loginButtons()).appendTo(a);var l=i.loginButtons.find("ul.ds-additional-services");i.loginButtons.find("a.ds-more-services").click(function(){l.toggle()})}else{var c=i.toolbar=r(A.toolbar()).appendTo(a);c.find(".ds-account-control").hover(function(){r(this).addClass("ds-active")},function(){r(this).removeClass("ds-active")}),c.find("a.ds-bind-more").click(v.bindMoreAccountDialog),c.find("a.ds-unread-comments-count").click(v.unreadCommentsDialog)}var p=i.replybox=new w.Replybox(i);a.append(r('<div style="height:0px;"><a name="respond">&nbsp;</a></div>'),p.render().el),u.message&&p.el.find("textarea").val(u.message).focus(),h("D")&&(r(".ds-replybox-main .ds-textarea-wrapper").find("textarea").live("focus blur keyup",function(e){var t=r(e.currentTarget).val();localStorage["messageTempContent"+s]=t}),localStorage["messageTempContent"+s]&&p.el.find("textarea").val(localStorage["messageTempContent"+s])),i.postListHead=new w.PostListHead(i,{thread:i.data,order:u.order}),i.postList=new b.PostList({embedThread:i,params:{source:"duoshuo",thread_id:s,order:u.order,limit:u.limit}}),i.paginator=new w.Paginator({collection:i.postList}),i.postListHead.render(),i.postList.render().reset(e.response),i.paginator.render().reset(o),p.postList=i.postList.el,u.formPosition=="top"?a.append(i.postListHead.el,i.postList.el,i.paginator.el):(i.loginButtons||c).before(i.postListHead.el,i.postList.el,i.paginator.el),r(A.indicator()).appendTo(n.body),r(A.poweredBy(H.data)).appendTo(a),j.on("reset",function(){var e=j.data.length;a.find("a.ds-unread-comments-count").html(e).attr("title",e?"\u4f60\u6709"+e+"\u6761\u65b0\u56de\u590d":"\u4f60\u6ca1\u6709\u65b0\u56de\u590d").css("display",e?"inline":"none")}),j.data!==t&&j.trigger("reset"),F.data!==t&&F.trigger("reset")}}),A.commentList=function(e,t){return r.map(e,function(e){var n=e.author_url||e.author&&e.author.url;return'<li class="ds-comment'+(t.show_avatars?" ds-show-avatars":"")+'" data-post-id="'+e.post_id+'">'+(t.show_avatars?n?'<a class="ds-avatar" rel="author nofollow" target="_blank" href="'+s(n)+'">'+A.avatar(e.author,t.avatar_size)+"</a>":'<div class="ds-avatar">'+A.avatar(e.author,t.avatar_size)+"</div>":"")+'<div class="ds-meta">'+A.authorAnchor(e)+(t.show_time?A.timeHtml(e.created_at):"")+"</div>"+(t.show_title?'<div class="ds-thread-title">\u5728 <a href="'+s(e.thread.url+"#comments")+'">'+l(e.thread.title)+'</a> \u4e2d\u8bc4\u8bba</div><div class="ds-excerpt">'+e.message+"</div>":'<a class="ds-excerpt" title="'+l(e.thread.title)+' \u4e2d\u7684\u8bc4\u8bba" href="'+s(e.thread.url+"#comments")+'">'+e.message+"</a>")+"</li>"}).join("")},A["comment-list-wordpress"]=function(e,t){return r.map(e,function(e){return'<li class="recentcomments">'+A.authorAnchor(e)+' \u5728 <a href="'+s(e.thread.url+"#comments")+'">'+l(e.thread.title)+"</a> \u4e2d\u8bc4\u8bba</li>"}).join("")},w.RecentCommentsWidget=L.extend({uri:"/api/sites/listRecentPosts",params:["show-avatars","show-time","show-title","avatar-size","show-admin","excerpt-length","num-items"],template:"commentList",render:function(){var e=this,t=e.el;this.options.template!=="wordpress"&&t.attr("id","ds-recent-comments")}}),A.recentVisitors=function(e,t){return r.map(e,function(e){return'<div class="ds-avatar">'+(e.url?'<a class="ds-avatar" rel="nofollow" target="_blank" href="'+s(e.url)+'" title="'+e.name+'">'+A.avatar(e,t.avatar_size)+"</a>":A.avatar(e,t.avatar_size))+"</div>"}).join("")},w.RecentVisitors=L.extend({uri:"/api/sites/listVisitors",params:["show-time","avatar-size","num-items"],template:"recentVisitors",render:function(){var e=this,t=e.el;t.children().detach(),t.attr("id","ds-recent-visitors"),e.waitingEl=r('<div class="ds-waiting"></div>').appendTo(this.el).html(A.waitingImg())}}),A.topUsersWidget=function(e,t){return r.map(e,function(e){return'<div class="ds-avatar">'+(e.url?'<a class="ds-avatar" rel="nofollow" target="_blank" href="'+s(e.url)+'" title="'+e.name+'">'+A.avatar(e,t.avatar_size)+"</a>":A.avatar(e,t.avatar_size))+"<h4>"+e.name+"</h4>"+"</div>"}).join("")},w.TopUsers=L.extend({uri:"/api/sites/listTopUsers",params:["show-time","avatar-size","num-items"],template:"topUsersWidget",render:function(){var e=this,t=e.el;t.children().detach(),t.attr("id","ds-top-users"),e.waitingEl=r('<div class="ds-waiting"></div>').appendTo(this.el).html(A.waitingImg())}}),A.topThreadsWidget=function(e,t){return r.map(e,function(e){return'<li><a target="_blank" href="'+s(e.url)+'" title="'+e.title+'">'+e.title+"</a>"+"</li>"}).join("")},w.TopThreads=L.extend({uri:"/api/sites/listTopThreads",params:["range","num-items"],template:"topThreadsWidget",render:function(){var e=this,t=e.el;t.children().detach(),t.attr("id","ds-top-threads"),e.waitingEl=r('<div class="ds-waiting"></div>').appendTo(this.el).html(A.waitingImg())}}),A.loginWidget=function(){var e='<div class="ds-icons-32">';return r.each(["weibo","qq","renren","kaixin","douban","netease","sohu"],function(t,n){e+='<a class="ds-'+n+'" href="javascript:void(0)">'+v.sourceName[n]+"</a>"}),e+"</div>"},w.LoginWidget=L.extend({template:"loginWidget",render:function(){var e=this.el;e.attr("id","ds-login").html(A.loginWidget()),e.find("a").each(function(e,t){var n=t.className.replace("ds-","");if(!v.serviceNames[n])return;t.href=A.loginUrl(n)}),e.find("a.ds-logout").attr("href",A.logoutUrl())},onload:function(){this.el.html(this.template(data,r.extend(this.options,options)))}}),w.ThreadCount=L.extend({onload:function(e){var t=this.el.data("count-type")||"comments",n=e.data[t];this.el[this.el.data("replace")?"replaceWith":"html"](H.data[t+"_"+(n?n>1?"multiple":"one":"zero")].replace("{num}",n))}});var U=0;v.initSelector=function(t,n){var i=[];e.duoshuoQuery&&(r.isReady||!r.browser.msie)&&r(t).each(function(t,s){var o=r(s);if(o.data("initialized"))return;o.data("initialized",!0);var u=g[++f]=new w[n.type](o,n);if(n.type==="ThreadCount"){var a=o.data("thread-key");i.push(a),P[a]||(P[a]=new D({})),P[a].on("reset",function(){u.onload(this)})}else if(u.uri){var l=z();if(e.location.href){var c=e.location.hash,h=e.location.href;l.url=c?h.replace(c,""):h}r.each(u.params,function(e,t){l[t.replace(/-/g,"_")]=o.data(t)}),T(u.uri+".jsonp",l,"DUOSHUO.pagelets["+f+"].load")}});if(i.length){var s=z();s.threads=i.join(","),T("/api/threads/counts.jsonp",s,function(e){k(e),r.each(e.response,function(e,t){P[t.thread_key]&&P[t.thread_key].set(t)})})}},W()||r(W),(v.initView=function(){r.each(m,v.initSelector)})(),r(function(){setInterval(function(){r(".ds-time").each(function(){var e=r(this).attr("datetime");e&&(this.innerHTML=v.elapsedTime(e))})},2e4);var t=e.duoshuoQuery;if(!t){y.log("\u7f3a\u5c11duoshuoQuery\u7684\u5b9a\u4e49");return}t.ondomready&&t.ondomready(),v.initView();if(!U&&t.short_name){var n=z();n.url=e.location.href,T("/api/analytics/ping.jsonp",n,k)}})}),v.injectStylesheet(v.STATIC+v.EMBED_STYLESHEET),v.require(["JSON","easyXDM"],function(){v.xhr=new easyXDM.Rpc({swf:v.REMOTE+"/easyxdm.swf",remote:v.REMOTE+"/cors/index.html",remoteHelper:v.REMOTE+"/name.html"},{remote:{request:{}}})})})(window);
